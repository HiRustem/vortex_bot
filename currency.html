<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <link rel="stylesheet" href="../assets/css/currency_style.css" />
  </head>
  <body class="page">
    <div class="container setting">
      <nav class="navbar">
        <a class="navbar-link" href="index.html#">
          <div class="navbar-brand">
            <img src="../assets/images/logo.png" alt="" width="64" />
            <h4 class="navbar-brand__heading">VortexBot</h4>
          </div>
        </a>
      </nav>

      <h1 class="settings-header" style="margin-bottom: 20px">VortexBot</h1>

      <div class="settings-section">
        <h2>Settings</h2>
        <h4 class="settings-description">Choose currency and timeframe</h4>

        <label for="currencyDropdown">
          Select currency
          <select
            id="currencyDropdown"
            name="currencyDropdown"
            class="dropdown"
          >
            <option value="USD/JPY" class="currency_item">USD/JPY</option>
            <option value="USD/CHF" class="currency_item">USD/CHF</option>
            <option value="USD/CAD" class="currency_item">USD/CAD</option>
            <option value="GBP/USD" class="currency_item">GBP/USD</option>
            <option value="EUR/USD" class="currency_item">EUR/USD</option>
            <option value="AUD/USD" class="currency_item">AUD/USD</option>
            <option value="BTC/USD" class="currency_item">BTC/USD</option>
            <option value="ETH/USD" class="currency_item">ETH/USD</option>
            <option value="SOL/USD" class="currency_item">SOL/USD</option>
            <option value="TON/USD" class="currency_item">TON/USD</option>
            <option value="DOGE/USD" class="currency_item">DOGE/USD</option>
            <option value="TRX/USD" class="currency_item">TRX/USD</option>
          </select>
        </label>

        <label for="timeframeDropdown">
          Select timeframe
          <select
            name="timeframeDropdown"
            id="timeframeDropdown"
            class="dropdown"
          >
            <option value="30 sec" class="timeframe_item">30 sec</option>
            <option value="1 min" class="timeframe_item">1 min</option>
            <option value="2 min" class="timeframe_item">2 min</option>
            <option value="5 min" class="timeframe_item">5 min</option>
            <option value="10 min" class="timeframe_item">10 min</option>
            <option value="15 min" class="timeframe_item">15 min</option>
          </select>
        </label>

        <!-- <div
          class="dropdown"
          style="margin-top: 15px; margin-left: auto; margin-right: 10px"
        >
          <a
            class="dropdown-toggle"
            href="#"
            role="button"
            id="currency"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            style="color: white"
          >
            {{ __('site.46') }}
          </a>
          <div
            class="dropdown-menu dropdown-menu-right"
            aria-labelledby="currency"
            style=""
          >
            <li>
              <a class="dropdown-item dropdown-item1" href="#">USD/JPY</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">USD/CHF</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">USD/CAD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">GBP/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">EUR/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">AUD/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">BTC/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">ETH/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">SOL/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">TON/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">DOGE/USD</a>
            </li>
            <li>
              <a class="dropdown-item dropdown-item1" href="#">TRX/USD</a>
            </li>
          </div>
        </div> -->

        <!-- <div class="dropdown" style="margin-left: auto; margin-right: 10px">
          <a
            class="dropdown-toggle"
            href="#"
            role="button"
            id="timeframe"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
            style="color: white"
          >
            Timeframe
          </a>
          <div
            class="dropdown-menu dropdown-menu-right"
            aria-labelledby="timeframe"
            style=""
          >
            <li><a class="dropdown-item dropdown-item1" href="#">30 sec</a></li>
            <li><a class="dropdown-item dropdown-item1" href="#">1 min</a></li>
            <li><a class="dropdown-item dropdown-item1" href="#">2 min</a></li>
            <li><a class="dropdown-item dropdown-item1" href="#">5 min</a></li>
            <li><a class="dropdown-item dropdown-item1" href="#">10 min</a></li>
            <li><a class="dropdown-item dropdown-item1" href="#">15 min</a></li>
          </div>
        </div> -->

        <p style="margin-top: 20px; text-align: start"></p>
      </div>

      <div class="chart-container">
        <iframe
          src="https://click.theclick-partners.com/A51TgWMU?landing=14"
          style="width: 0%; max-height: 700px; height: 0%; display: none"
        >
        </iframe>
        <button class="button" id="start" disabled>Start signal</button>

        <div id="scale-container" class="hidden">
          <div
            class="scale"
            id="scale-green"
            style="
              height: 100%;
              background-color: #28a745;
              width: 50%;
              font-size: 30px;
            "
          ></div>
          <div
            class="scale"
            id="scale-red"
            style="
              height: 100%;
              background-color: red;
              width: 50%;
              font-size: 30px;
            "
          ></div>
        </div>

        <div class="percent">
          <div class="up"></div>
          <div class="down"></div>
        </div>
      </div>

      <script>
        // document.addEventListener('DOMContentLoaded', () => {
        //     // Проверяем значение currencyPage в LocalStorage
        //     const currencyPage = localStorage.getItem('currencyPage');
        //
        //     if (currencyPage !== 'true') {
        //         // Если значение не равно true, перенаправляем на главную страницу
        //         window.location.href = '/';
        //     }
        //     // Если значение равно true, остаемся на текущей странице
        // });

        let currencySelected = false;
        let timeframeSelected = false;
        let up = 50; // Начальное значение
        let down = 50; // Начальное значение
        let timeoutUp, timeoutDown;

        const currencyDropdown = document.querySelector("#currencyDropdown");
        const timeframeDropdown = document.querySelector("#timeframeDropdown");
        const startButton = document.querySelector("#start");
        const scaleContainer = document.querySelector("#scale-container");

        const percentUp = document.querySelector(".percent .up");
        const percentDown = document.querySelector(".percent .down");

        let timerId;

        let currencyDropdownValue = "";
        let timeframeDropdownValue = "";
        let isStartDisabled = true;

        currencyDropdown.value = "";
        timeframeDropdown.value = "";

        function checkStartDisabled() {
          if (!!timeframeDropdownValue && !!currencyDropdownValue) {
            isStartDisabled = false;
            startButton.disabled = isStartDisabled;
          }

          if (!timeframeDropdownValue || !currencyDropdownValue) {
            isStartDisabled = true;
            startButton.disabled = isStartDisabled;

            if (startButton.classList.contains("hidden")) {
              startButton.classList.remove("show");
              startButton.classList.add("hidden");
            }
          }
        }

        function checkIntervalStarted() {
          if (startButton.classList.contains("hidden")) {
            clearInterval(timerId);
            startButton.classList.remove("hidden");

            scaleContainer.classList.remove("flex");
            scaleContainer.classList.add("hidden");

            percentUp.innerHTML = "";
            percentDown.innerHTML = "";
          }
        }

        currencyDropdown.addEventListener("change", (event) => {
          currencyDropdownValue = event.target.value;

          checkIntervalStarted();
          checkStartDisabled();
        });

        timeframeDropdown.addEventListener("change", (event) => {
          timeframeDropdownValue = event.target.value;

          checkIntervalStarted();
          checkStartDisabled();
        });

        document.querySelectorAll(".dropdown-item1").forEach(function (item) {
          item.addEventListener("click", function (e) {
            e.preventDefault();

            var parentDropdown = this.closest(".dropdown");
            var dropdownToggle =
              parentDropdown.querySelector(".dropdown-toggle");

            dropdownToggle.textContent = this.textContent; // Обновляем текст dropdown-toggle
            dropdownToggle.setAttribute("aria-expanded", "false"); // Закрываем dropdown
            parentDropdown
              .querySelector(".dropdown-menu")
              .classList.remove("show"); // Убираем класс 'show'

            // Проверяем, какой dropdown был изменен, и обновляем статус
            if (parentDropdown.contains(document.getElementById("currency"))) {
              currencySelected = true;
            } else if (
              parentDropdown.contains(document.getElementById("timeframe"))
            ) {
              timeframeSelected = true;
            }

            // Включаем кнопку "старт", если все параметры выбраны
            // if (currencySelected && timeframeSelected) {
            //   document.getElementById("start").disabled = false;
            // } else {
            //   document.getElementById("start").disabled = true;
            // }

            // Сброс и скрытие контейнера при изменении выбора
            document.getElementById("scale-container").style.display = "none";
            // document.getElementById("start").disabled = false;

            // Сбрасываем значения up и down до 50 и перезапускаем обновление
          });
        });

        document.getElementById("start").addEventListener("click", function () {
          if (!currencyDropdownValue || !timeframeDropdownValue) {
            alert(
              "Please select both a currency and a timeframe before starting."
            );
            return;
          }

          startButton.classList.add("hidden");

          up = 50;
          down = 50;
          updatePercentages(); // Немедленное обнов

          if (timerId) clearInterval(timerId);

          timerId = setInterval(updatePercentages, 1800);

          scaleContainer.classList.remove("hidden");
          scaleContainer.classList.add("flex");
        });

        function updatePercentages() {
          let change = Math.random() * 3; // Случайное изменение от 2% до 10%
          change *= Math.random() < 0.5 ? -1 : 1; // Определение, увеличивать ли или уменьшать

          // Предварительное изменение up и down
          let newUp = up + change;
          let newDown = down - change;

          // Проверка и корректировка значений up и down
          if (newUp > 91.5) {
            newUp = 91.5;
            newDown = 100 - newUp; // Корректируем down, чтобы сумма была 100%
          } else if (newDown > 91.5) {
            newDown = 91.5;
            newUp = 100 - newDown; // Корректируем up, чтобы сумма была 100%
          } else if (newUp < 8.5) {
            newUp = 8.5;
            newDown = 100 - newUp; // Корректируем down, чтобы сумма была 100%
          } else if (newDown < 8.5) {
            newDown = 8.5;
            newUp = 100 - newDown; // Корректируем up, чтобы сумма была 100%
          }

          // Устанавливаем новые значения
          up = newUp;
          down = newDown;

          let upHTML = `${up.toFixed(1)}%`;
          let downHTML = `${down.toFixed(1)}%`;
          const scaleGreen = document.getElementById("scale-green");
          const scaleRed = document.getElementById("scale-red");
          scaleGreen.style.width = `${up.toFixed(1)}%`;
          scaleRed.style.width = `${down.toFixed(1)}%`;

          // Изменяем цвет, если значения превышают 60%
          scaleGreen.style.backgroundColor = up >= 60 ? "#28a745" : "#155724"; // Темно-зеленый, если up > 60%
          scaleRed.style.backgroundColor = down >= 60 ? "red" : "#721c24"; // Темно-красный, если down > 60%

          // Update the UI elements with new values
          scaleGreen.textContent = upHTML;
          scaleRed.textContent = downHTML;

          let upHTML2 = up >= 60 ? `OPEN ORDER HIGHER ` : ``;
          let downHTML2 = down >= 60 ? `OPEN ORDER LOWER ` : ``;

          percentUp.innerHTML = upHTML2;
          percentDown.innerHTML = downHTML2;
        }
      </script>
    </div>
  </body>
</html>
